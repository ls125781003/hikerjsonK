<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<title>h5音乐播放器_by顺承天意(2023.10.10)</title>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<!-- <script src="https://cdn.bootcdn.net/ajax/libs/zepto/1.2.0/zepto.min.js"></script> -->
<!-- <script src="https://hikerfans.com/weisyr/js/zepto-module.js"></script> -->
<script type="text/javascript">
	eval(fy_bridge_app.getInternalJs());
	window.request = window.request00 || window.request;
</script>
<style type="text/css">
@font-face {
	font-family: "iconfont";
	src: url('iconfont.eot?t=1583039253866'); /* IE9 */
	src: url('iconfont.eot?t=1583039253866#iefix') format('embedded-opentype'), /* IE6-IE8 */
	url('data:application/x-font-woff2;charset=utf-8;base64,d09GMgABAAAAAAO4AAsAAAAACLAAAANrAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCDQAqEIIM5ATYCJAMYCw4ABCAFhG0HZBtzBxEVnHfIfhzkpqnr/HGf42RNtEXjvwfPY95/5yZpX7+EJQai9pS20wBY3BQFO8ZEKJ6cvf76rKQlvNC78z/HTJfWYPmB5pTZtDccjhJoQBkXzUd2B9ICh3wgIJ7NYF+8HwJ4E08uUr1m/eY4GIJNAkj/Pr264LQ0mBmy4MjtkZMGWYyFo+aoq8Ci/P3lC8XigMLSBDsb96zRncrv1ftnerI7mfYpAu7pTIB2DjSQCxiQ4aOWgegykovG2wkZqoK730Gh3uv3ke+XvX/muqcVIHggize+YTZYGNSJ/nliE+T6AlCfqAXvVcyppRoVBmkkYuakyxCD9Bm8j6SwT7jCG1gMVwhwqYQFjQpFvjj9/QOD+evjhuyYnDp4++Foa92Rbvfvt3zwoNW9ey3u3h17923ze+9aPPjQ6v771mfvJm65V+PCg5St98edu5dkNt+tfv5+srXtwaCWq5X3zr2n2Lkvw2fHniizene7XvvOZa2hXHM0dW56z50bY1aNG5Wlrkpu3X33+ey1Iu0+kTEvrceODZHLfUvSd0wcUDwg2TFulff/3SrcoPX66lUthOtVFoK6yOtO38cmIcEgfCyzaJKTet9s2tTPL5bdzGcQeMd/SN26EcERsnxI0TtOuuu4Fp8++Lunief7YPn3Xzx5R8Hk2ZG3Iwr8R70Mj9kZlTfvTC1Kgl+umdseAPeanqJLWP5bj9b+AHqxei1si9TLv/xj+HR6zsROAWX/HB8DwOMp3cOocCcb9GT436Ss5v7B3JUdxuUHWtvY7eOjCGCTigZA+QPewB/rCOb5qWxhUJsER+cCCg9xoHFIRRpsLlj4UAo2DpXAmxxqnfchhKFoxHgB2cwQIARyCBT+nABNINeQBvsMLML5BjaBosGblhJyTR/SBcO7oyMM1MH7B6xk0ZE+7Ir8G5k4oWvyc8qLnGc/NGXdjV9pIXeKPT6ZNgQN2skMF/EwmiaB1clAKpR9COuhqvTYK5VK5mxHNUcYqIP3D1jJotP+Ydd7+xuZOKGbaeswv8h5nh6asl6BvEqWVW1vZb5Ppg1By+u0kxkumGgKIwLr+LKBVCj7HaH1UEnd9FpJeXnZ/C1PAN4EL7VFiRYjltjiwa8vU8e4jMi+51zR63S54o+fKWkxe99jKvqNZkncfhlLdZYBAA==') format('woff2'),
	url('iconfont.woff?t=1583039253866') format('woff'),
	url('iconfont.ttf?t=1583039253866') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */
	url('iconfont.svg?t=1583039253866#iconfont') format('svg'); /* iOS 4.1- */
}
.iconfont {
	font-family: "iconfont" !important;
	font-size: 16px;
	font-style: normal;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}
.icon-jiediankaishi:before {
	content: "\e6dd";
}
.icon-center:before {
	content: "\e618";
}
.icon-zanting:before {
	content: "\e693";
}
.icon-shangyishou:before {
	content: "\e603";
}
.icon-xiayishou:before {
	content: "\e602";
}
* {
	text-size-adjust: none;
	-webkit-user-select: none;
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}
@media (prefers-color-scheme: light) {
  :root {
	--background-color: white;
	--part-background: rgba(253, 253, 253, 1);
  }
}
@media (prefers-color-scheme: dark) {
  :root {
	--background-color: #1b1b1b;
	--part-background: rgba(25,25,25, 1.0);
  }
}
#player{
	position: absolute;
	left:0px;
	right: 0px;
	height: 100%;
	background: rgb(0, 0, 0,.4);
}
/* 歌曲信息模块 */
#player-content1{
	position: absolute;
	/top: 210px;
	bottom: 0px;
	left: 15px;
	right: 15px;
	height: 90px;
	padding:0 20px 0 130px;
	background: rgb(209, 226, 245);
	opacity: 0.5;
	border-top-left-radius: 10px;
	border-top-right-radius: 10px;
	/* transition过渡动画：设置top属性过渡，过渡时间0.3s,速度曲线为ease(逐渐变慢) */
	transition:top 0.3s ease; 
}
#player-content1.active{
	/top:120px;
	bottom: 90px;
}
.music-name,
.artist-name{
	height: 20px;
	margin-top:5px;
	font-size:15px;
	font-weight: 700;
	color: rgba(27,27,27,.9);
	/overflow: auto;
}
.artist-name{
	font-size:12px;
	color: #656565
}
.time{
	font-size:12px;
	height:15px;
	margin: 5px 0;
}
.current-time{
	float: left;
}
.total-time{
	float: right;
}
.current-time,.total-time{
	color: transparent;
	font-size: 11px;
	background-color: #e8f5ff;
	border-radius: 10px;
	transition: 0.3s ease all;
}
.time.active .current-time, .time.active .total-time{
	color: rgb(54, 127, 196);
	background-color: transparent;
}

#s-area, #seek-bar{
	position: relative;
	height: 4px;
	border-radius: 4px;
}

#s-area{
	background-color:#e8f5ff;
	cursor: pointer;
}

#ins-time{
	position: absolute;
	top: -29px;
	color: #fff;
	font-size: 12px;
	white-space: pre;
	padding: 5px 6px;
	border-radius: 4px;
	display:none;
}

#s-hover{
	position: absolute;
	top: 0;
	bottom: 0;
	left: 0;
	opacity: 0.2;
	z-index: 2;
}

#ins-time, #s-hover{
	background-color: #4b4d5c;
}

#seek-bar{
	content: '';
	position: absolute;
	top: 0;
	bottom: 0;
	left: 0;
	width: 0;
	background-color: rgb(54, 127, 196);
	transition: 0.2s ease width;
}

#player-content2{
	position: absolute;
	/top: 210px;
	bottom: 0px;
	height: 90px;
	left: 0px;
	right: 0px;
	/background: #fff;
	background: var(--part-background);
	border-radius: 20px 20px 0 0;
	/box-shadow: 0 30px 80px #656565;
}
/* 左侧封面图模块 */
.music-imgs{
	position: absolute;
	top: -40px;
	width: 100px;
	height: 100px;
	margin-left: 30px;
	-webkit-transform: rotateZ(0);
	transition: 0.3s ease all;
	box-shadow: 0 0 0 6px #fff;
	border-radius: 50%;
	overflow: hidden;
}
/* 左侧封面图模块添加了active类名 */
.music-imgs.active{
	top: -50px;
	box-shadow: 0 0 0 4px #e8f5ff, 0 20px 20px -20px #afb7c1;
}
.music-imgs:before{
	content: '';
	position: absolute;
	top: 50%;
	right: 0;
	left: 0;
	width: 20px;
	height: 20px;
	margin: -10px auto 0 auto;
	background-color: #d6dee7;
	border-radius: 50%;
	box-shadow: inset 0 0 0 2px #fff;
	z-index: 2;
}
/* 左侧封面图模块下的 图片div */
.music-imgs img{
	width: 120%;
	height: 120%;
	margin: -10%;
	object-fit: cover;
}
/* 封面图模块添加了active类名后，图片div的样式添加 */
.music-imgs.active img {
	z-index: 1;
	-webkit-animation: rotateAlbumArt 6s linear 0s infinite forwards;
}
@-webkit-keyframes rotateAlbumArt {
	0%{ -webkit-transform: rotateZ(0); transform: rotateZ(0); }
	100%{ -webkit-transform: rotateZ(360deg); transform: rotateZ(360deg); }
}
#buffer-box {
	position: absolute;
	top: 50%;
	right: 0;
	left: 0;
	height: 13px;
	color: #1f1f1f;
	font-size: 13px;
	font-family: Helvetica;
	text-align: center;
	font-weight: bold;
	line-height: 1;
	padding: 6px;
	margin: -12px auto 0 auto;
	background-color: rgba(255, 255, 255, 0.19);
	opacity: 0;
	z-index: 2;
}

.music-imgs .img, #buffer-box {
	transition: 0.1s linear all;
}

.music-imgs.buffering .img {
	opacity: 0.25;
}

.music-imgs.buffering .img.active {
	opacity: 1.8;
	filter: blur(2px);
	-webkit-filter: blur(2px);
}

.music-imgs.buffering #buffer-box {
	opacity: 1;
}

.player-controls{
	position: absolute;
	top:15px;
	right: 0px;
	/* left: 0; */
}
.player-controls .btn{
	float: left;
	width:60px;
	height:60px;
	line-height: 60px;
	font-size:24px;
	color:#D6DEE7;
}
.bg_img {
	overflow: hidden;
	width: 100%;
	height: 100%;
	position: absolute;
	z-index: -1;
	Left: 0px;
	/* top: -100px; */
}
.bg_maker {
	width: 100%;
	height: 100%;
	position: absolute;
	Left: 0px;
	top: 0px;
	background: rgba(0, 0, 0, .6);
	z-index: 20;
}
.bg_img img {
	width: 120%;
	height: 100%;
	margin: -10%;
	object-fit: cover;
	filter: blur(3px);
}
.down img {
	width: 50%;
	height: 40%;
	margin: -7%;
	/object-fit: cover;
	
}
canvas{
	width: 100%;
	height: 100vh;
	position: absolute;
	opacity: 0.5;
	/background: rgba(0, 0, 0, .6);
   / top: 60px;
}
#lrc {
	position: absolute;
	display: none;
	width: 100%;
	height: 100%;
	z-index: 1;
	pointer-events: none;
}
.play {
	/background-color: black;
	font-size: 20px;
	font-weight: 700;
	color:#D6DEE7;
}
</style>
</head>
<body>
<canvas></canvas>
<div id="player">
	<!-- 歌曲信息模块 -->
	<div id='lrc'></div>
	<canvas id='eq'></canvas>
	<div id="player-content1">
		<!-- 歌曲名 -->
		<marquee width = "100%" behavior = "scroll" scrolldelay = '240'>
			<div class="music-name"></div>
		</marquee>
		<!-- 歌手名 -->
		<div class="artist-name"></div>
		<!-- 歌曲时间 -->
		<div class="time">
			<!-- 当前播放的时间 -->
			<div class="current-time"></div>
			<!-- 歌曲总时长 -->
			<div class="total-time"></div>
		</div>
		<!-- 进度条 -->
		<div id="s-area">
			<!-- 显示的时间信息 -->
			<div id="ins-time"></div>
			<!--进度条变暗部分-->
			<div id="s-hover"></div>
			<!-- 表示当前歌曲播放进度的蓝色进度条 -->
			<div id="seek-bar"></div>
		</div>
	</div>
	<div class="bg_img">
		<div class="bg_maker"></div>
		<img id="img1">
	</div>

	<!-- 控制模块 -->
	<div id="player-content2">
		<!-- 左侧歌曲封面旋转模块 -->
		<div class="music-imgs">
			<!-- 封面图 -->
			<img id="img1">
			<!-- <div class="img"></div> -->
			<!-- 歌曲缓冲时的提示文字 -->
			<div id="buffer-box">缓冲…</div>
		</div>
		<!-- 右侧歌曲操作模块 -->
		<div class="player-controls">
			<div class="btn down iconfont"><img src="https://hikerfans.com/weisyr/icon/down.svg"/></div>
			<!-- 上一首按钮 -->
			<div class="btn prev iconfont">&#xe603;</div>
			<!-- 暂停/播放 按钮 -->
			<div class="btn play-pause icon-jiediankaishi iconfont"></div>
			<!-- 下一首按钮 -->
			<div class="btn next iconfont">&#xe602;</div>
		</div>
	</div>
</div>

<script>
$(function() {
	var playerContent1 = $('#player-content1');// 歌曲信息模块部分dom元素
	var musicName = $('.music-name');		// 歌曲名部分dom元素 
	var artistName = $('.artist-name');		// 歌手名部分dom元素
	var musicImgs = $('.music-imgs');		// 左侧封面图dom元素
	var playPauseBtn = $('.play-pause, #img1');	// 播放/暂停按钮 dom元素
	var playPrevBtn = $('.prev');			// 上一首按钮 dom元素
	var playNextBtn = $('.next')			// 下一首按钮 dom元素
	var time = $('.time');					// 时间信息部分 dom元素
	var tProgress = $('.current-time');		// 当前播放时间文本部分 dom元素
	var totalTime = $('.total-time');		// 歌曲总时长文本部分 dom元素
	var sArea = $('#s-area');				// 进度条部分
	var insTime = $('#ins-time');			// 鼠标移动至进度条上面，显示的信息部分
	var sHover = $('#s-hover');				// 鼠标移动至进度条上面，前面变暗的进度条部分
	var seekBar = $('#seek-bar');			// 播放进度条部分
	
	var data = JSON.parse(fba.getVar("音乐数据"));
	//fba.log(JSON.stringify(data))
	var musicImgsData = []	// 封面
	var musicNameData = []	// 曲名
	var artistNameData = []	// 歌手
	var musicUrls=[];
	var musicID=[];
	for (let i = 0; i < data.length; i++) {
		musicImgsData.push(data[i].封面);
		musicNameData.push(data[i].曲名);
		artistNameData.push(data[i].歌手);
		musicUrls.push(data[i].地址);
		musicID.push(data[i].ID);
	}
	//fba.log(JSON.stringify(musicID))

	// var musicImgsData = ['https://p7.itc.cn/q_70/images03/20210622/4a5306b0f22444738f5a501c3d95aecc.jpeg','http://oss.tan8.com/resource/attachment/7678390/7678390.png']	// 图片地址数组
	// var musicNameData = ['晴天','十年'];				// 歌曲名数组
	// var artistNameData = ['周杰伦','陈奕迅']			// 创作歌手数组
	// var musicUrls=['https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/a4f15326-a023-4e59-b92b-c0d91fea29cd.mp3','https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7184a2f2-3b0b-407a-adc8-4d450f35c1e7/e1676efb-85aa-4fe0-b73b-74bbeadf88ae.mp3'];// 歌曲mp3数组
	// 一些计算所需的变量
	var seekT, seekLoc, seekBarPos, cM, ctMinutes, ctSeconds, curMinutes, curSeconds, durMinutes, durSeconds, playProgress, bTime, nTime = 0;
	var currIndex;	// 当前播放索引(下标减1)
	if(fba.getVar('刷新id'))
		currIndex = musicID.indexOf(fba.getVar('刷新id'))-1 || 0;
	else
		currIndex = -1;

	var buffInterval = null		// 初始化定时器 判断是否需要缓冲
	var len = musicNameData.length;	// 歌曲数量
	

	// 点击 播放/暂停 按钮，触发该函数
	// 作用：根据audio的paused属性 来检测当前音频是否已暂停 true:暂停 false:播放中
	function playPause(){
		$('#player-content1, .music-imgs').css({'transition':' 0.2s ease all'});
		if(audio.paused){
			playerContent1.addClass('active'); // 内容栏上移
			musicImgs.addClass('active');	// 左侧图片开始动画效果
			playPauseBtn.attr('class','btn play-pause icon-zanting iconfont') // 显示暂停图标
			checkBuffering(); // 检测是否需要缓冲
			audio.play();	 // 播放
		}else{
			playerContent1.removeClass('active'); // 内容栏下移
			musicImgs.removeClass('active');	// 左侧图片停止旋转等动画效果
			playPauseBtn.attr('class','btn play-pause icon-jiediankaishi iconfont'); // 显示播放按钮
			clearInterval(buffInterval);		// 清除检测是否需要缓冲的定时器
			musicImgs.removeClass('buffering');	// 移除缓冲类名
			audio.pause(); // 暂停
		}
	}

	// 鼠标移动在进度条上， 触发该函数	
	function showHover(event){
		seekBarPos = sArea.offset();	// 获取进度条长度
		seekT = event.clientX - seekBarPos.left;	//获取当前鼠标在进度条上的位置
		seekLoc = audio.duration * (seekT / sArea.outerWidth()); //当前鼠标位置的音频播放秒数：音频长度(单位：s)*（鼠标在进度条上的位置/进度条的宽度）

		sHover.width(seekT);	//设置鼠标移动到进度条上变暗的部分宽度
		cM = seekLoc / 60;	// 计算播放了多少分钟：音频播放秒速/60

		ctMinutes = Math.floor(cM);  // 向下取整
		ctSeconds = Math.floor(seekLoc - ctMinutes * 60); // 计算播放秒数

		if( (ctMinutes < 0) || (ctSeconds < 0) ) return;
		if(ctMinutes < 10) ctMinutes = '0'+ctMinutes;
		if(ctSeconds < 10) ctSeconds = '0'+ctSeconds;

		if( isNaN(ctMinutes) || isNaN(ctSeconds) )
			insTime.text('--:--');
		else
			insTime.text(ctMinutes+':'+ctSeconds);  // 设置鼠标移动到进度条上显示的信息

		insTime.css({'left':seekT,'margin-left':'-21px'}).fadeIn(0);  // 淡入效果显示
	}

	// 鼠标移出进度条，触发该函数
	function hideHover() {
		sHover.width(0);  // 设置鼠标移动到进度条上变暗的部分宽度 重置为0
		insTime.text('00:00').css({'left':'0px','margin-left':'0px'}).fadeOut(100); // 淡出效果显示
	}

	// 鼠标点击进度条，触发该函数
	function playFromClickedPos() {
		audio.currentTime = seekLoc; // 设置音频播放时间 为当前鼠标点击的位置时间
		seekBar.width(seekT);		// 设置进度条播放长度，为当前鼠标点击的长度
		hideHover();				// 调用该函数，隐藏原来鼠标移动到上方触发的进度条阴影
	}

	// 在音频的播放位置发生改变是触发该函数
	function updateCurrTime() {
		nTime = new Date().getTime(); // 获取时间转化为毫秒数
		// 计算当前音频播放的时间
		curMinutes = Math.floor(audio.currentTime  / 60);
		curSeconds = Math.floor(audio.currentTime  - curMinutes * 60);
		// 计算当前音频总时间
		durMinutes = Math.floor(audio.duration / 60);
		durSeconds = Math.floor(audio.duration - durMinutes * 60);
		// 计算播放进度百分比
		playProgress = (audio.currentTime  / audio.duration) * 100;
		// 如果时间为个位数，设置其格式
		if(curMinutes < 10) curMinutes = '0'+curMinutes;
		if(curSeconds < 10) curSeconds = '0'+curSeconds;
		if(durMinutes < 10) durMinutes = '0'+durMinutes;
		if(durSeconds < 10) durSeconds = '0'+durSeconds;
		if( isNaN(curMinutes) || isNaN(curSeconds) )
			tProgress.text('00:00');
		else
			tProgress.text(curMinutes+':'+curSeconds);

		if( isNaN(durMinutes) || isNaN(durSeconds) )
			totalTime.text('00:00');
		else
			totalTime.text(durMinutes+':'+durSeconds);

		if( isNaN(curMinutes) || isNaN(curSeconds) || isNaN(durMinutes) || isNaN(durSeconds) )
			time.removeClass('active');
		else
			time.addClass('active');

		// 设置播放进度条的长度
		seekBar.width(playProgress+'%');

		// 进度条为100 即歌曲播放完时
		if( playProgress == 100 ) {
			playPauseBtn.attr('class','btn play-pause icon-jiediankaishi iconfont'); // 显示播放按钮
			seekBar.width(0);			// 播放进度条重置为0
			tProgress.text('00:00');	// 播放时间重置为 00:00
			musicImgs.removeClass('buffering').removeClass('active');	// 移除相关类名
			clearInterval(buffInterval);	// 清除定时器
			selectTrack(1);	// 实现自动播放下一曲
			updateIte()
		}
	}

	// 定时器检测是否需要缓冲
	function checkBuffering() {
		clearInterval(buffInterval);
		buffInterval = setInterval(function() { 
			// 这里如果音频播放了，则nTime为当前时间毫秒数，如果没播放则为0；如果时间间隔过长，也将缓存
			if( (nTime == 0) || (bTime - nTime) > 1000  ){
				musicImgs.addClass('buffering');  // 添加缓存样式类
			} else{
				musicImgs.removeClass('buffering'); // 移除缓存样式类
			}
			bTime = new Date().getTime();
		},100);
	}

	// 点击上一首/下一首时，触发该函数。 
	//注意：后面代码初始化时，会触发一次selectTrack(0)，因此下面一些地方需要判断flag是否为0
	function selectTrack(flag) {
		if( flag == 0 || flag == 1 ) {	// 初始 || 点击下一首
			++currIndex;
			if (currIndex >= len) {	// 当处于最后一首时，点击下一首，播放索引置为第一首
				currIndex = 0;
			}
		} else {					// 点击上一首
			--currIndex;
			if (currIndex <= -1 ) {	// 当处于第一首时，点击上一首，播放索引置为最后一首;
				currIndex = len-1;
			}
		}
		//fba.log(currIndex);

		if( flag == 0 ) {
			playPauseBtn.attr('class','btn play-pause icon-jiediankaishi iconfont'); // 显示播放图标
		} else {
			musicImgs.removeClass('buffering');   
			playPauseBtn.attr('class','btn play-pause icon-zanting iconfont') // 显示暂停图标
		}

		seekBar.width(0);		   // 重置播放进度条为0
		time.removeClass('active');
		tProgress.text('00:00');	// 播放时间重置
		totalTime.text('00:00');	// 总时间重置

		// 获取当前索引的:曲名，歌手，封面，地址
		currMusic = musicNameData[currIndex];
		currArtist = artistNameData[currIndex];
		currImg = musicImgsData[currIndex];
		playurl = musicUrls[currIndex];
		info = currArtist + '-' + currMusic;
		lrc_info=currMusic+' - '+currArtist;
		// 同步解析
		if (musicUrls[currIndex].indexOf("@lazyRule")>-1) {
			playurl = fba.parseLazyRule(musicUrls[currIndex])
		}
		
		//fy_bridge_app.parseLazyRuleAsync(lazy2, $$$.toString(()=>fba.log(input)))


		audio.src = playurl
		fba.putVar('播放链接', playurl)
		nTime = 0;
		bTime = new Date().getTime();

		// 如果点击的是上一首/下一首 则设置开始播放，添加相关类名，重新开启定时器
		if(flag != 0) {
			audio.play();
			playerContent1.addClass('active');
			musicImgs.addClass('active');
			clearInterval(buffInterval);
			checkBuffering();
		}

		// 将歌手，曲名，封面，设置到元素上
		artistName.text(currArtist);
		musicName.text(currMusic);
		// musicImgs.find('.img').css({'background':'url('+currImg+')'})
		musicImgs.find('#img1').attr('src', currImg)
		$('#img1').attr('src', currImg);
		
		fba.log(lrc_info)
		//异步匹配歌词
		fba.parseLazyRuleAsync($$$("#noLoading#").lazyRule((lrc_info) => {
			try{
				let lrc_id=pdfh(request("https://www.8lrc.com/search/?key="+lrc_info),".tGequ&&href").match(/\d+/g)[0];
				lrc_url= 'https://www.8lrc.com/downlrc.php?id='+lrc_id;
				log(lrc_url)
				return request(lrc_url);
			} catch(e) {
				return  `[00:00.000] 暂无歌词`
			}
		},lrc_info), $$$.toString(() => {
			$('#lrc div').remove();
			function newLRC() {
				let ele = document.getElementById('lrc');
				let musicArea = document.createElement('div');
				let musicUl = document.createElement('ul');
				let a = 400; //歌词容器高；
				let b = 35; //li的高度，无特殊要求
				ele.appendChild(musicArea);
				musicArea.appendChild(musicUl);
				musicStyle();
	
				function musicStyle() { //控件css样式；
					musicArea.style.width = '100%';
					musicArea.style.height = '75%';
					musicArea.style.overflow = 'hidden'
						//musicArea.style.outline ='3px solid'
					musicUl.style.listStyle = 'none';
					musicUl.style.width = '100%'
					musicUl.style.padding = '0';
				}
				/*
				let lrc = `
				[00:00.000] 作词 : 周杰伦
				[00:01.000] 作曲 : 周杰伦
					`
				*/
				//把歌词变成[{time,lrc},{time,lrc}...]的样子，不然没法用
				function split() { //把lrc歌词分割成数组，
					let split_1 = lrc.split('\n');
					let length = split_1.length;
					for (let i = 0; i < length; i++) {
						let lrcArr = split_1[i];
						split_1[i] = change(lrcArr);
						function change(str) {
							let lrc = str.split(']');
							let timer = lrc[0].replace('[', '');
							let str_music = lrc[1];
							let time_split = timer.split(':');
							let s = +time_split[1];
							let min = +time_split[0];
							return {
								time: min * 60 + s,
								lrc: str_music //分割好到歌词和时间
							}
	
						}
					}
					return split_1
				}
				let lrcArr = split(); //至此歌词处理完了。
				createLi();
	
				function createLi() { //根据歌词数组创建li
					let len = lrcArr.length;
					for (let i = 0; i < len; i++) {
						let lrc_li = lrcArr[i];
						let li = document.createElement('li');
						li.innerText = lrc_li.lrc;
						li.style.height = b + 'px'
						li.style.textAlign = 'center'
						li.style.width = '100%'
						li.style.padding = '0';
						li.style.color = '#999'
						li.style.transition = '0.3s'
						musicUl.appendChild(li);
					}
				}
	
				function setCurrentLi() {
					let time = audio.currentTime;
					//fba.log(time)
					for(let i = 0; i < lrcArr.length; i++ ) {
						let play = lrcArr[i];
						if (time - play.time<=0) {
							return i;
						}
					}
					return -1;
				}
	
				function current() { //设置top，让其滚动
					let li = setCurrentLi();
					let divHeight = a;
					let liHeight = b;
					let top = liHeight * li - divHeight / 2 + liHeight / 2;
					if (top < 0) {
						top = 0;
					}
					musicUl.style.marginTop = -top + 'px';
					// fba.log('top'+top);
					let playLi = musicUl.querySelector('.play')
					if (playLi) {
						playLi.className = '';
					}
					if (li >= 0) {
						musicUl.children[li - 1].className = 'play'
	
					}
				}
				audio.ontimeupdate = current;
			}
			//fba.log(input)
			let lrc  = input;
			newLRC();
		}));
		
		
		function Dynamic() {
			const cvs=document.querySelector('canvas');
			const ctx=cvs.getContext('2d');
			// 初始化画布
			function initCvs(){
				cvs.width=window.innerWidth * devicePixelRatio;
				cvs.height=(window.innerHeight / 2) * devicePixelRatio;
			}
			initCvs();
			// 是否已初始化
			let isInit=false;
			// 数组，用于接收分析器节点的分析数据
			let dataArray;
			// 分析器节点
			let analyser;
			// 音频播放事件
			// 判断是否初始化
			if(isInit) return;
			// 开始初始化
			// 创建音频上下文
			const audioCtx=new AudioContext();
			// 创建音频源节点
			const source=audioCtx.createMediaElementSource(audio);
			// 创建分析器节点
			analyser=audioCtx.createAnalyser();
			analyser.fftSize=512;
			// 接收分析器节点的分析数据
			dataArray=new Uint8Array(analyser.frequencyBinCount);
			source.connect(analyser);
			analyser.connect(audioCtx.destination);
			// 已初始化
			isInit=true;
			//把分析出来的波形绘制到canvas上
			function draw() {
				// 逐帧绘制
				requestAnimationFrame(draw);
				// 接下来清空画布
				const { width, height } = cvs;
				ctx.clearRect(0,0,width,height);
				if(!isInit){
					return;
				}
				// 让分析器节点分析出数据到数组中
				analyser.getByteFrequencyData(dataArray);
				const len=dataArray.length / 20; //条的数量
				const barWidth=width / len / 2; //条的宽度
				ctx.fillStyle='#55aaff';
				// 循环绘制
				for(let i=0;i< len;i++){
					const data=dataArray[i];
					const barHeight=(data / 255) * height; //条的高度
					const x1=i * barWidth + width / 2; //右边区域中条的x坐标
					const x2=width / 2 - (i + 1) * barWidth; //左边区域中条的x坐标 镜像
					const y=height - barHeight; //条的y坐标
					ctx.fillRect(x1,y,barWidth - 2,barHeight); //填充右边区域
					ctx.fillRect(x2,y,barWidth - 2,barHeight); //填充左边区域
				}
			}
			draw();
		}
		Dynamic();
		
	}

	// 初始化函数
	function initPlayer() {
		audio = new Audio();  // 创建Audio对象
		selectTrack(1);	   // 初始化第一首歌曲的相关信息 0不播放 1自动播放
		let 循环;
		if (fba.getVar('循环')=='单曲循环')
			循环=true
		else
			循环=false
		//fba.log(循环)
		audio.loop = 循环;   // false取消歌曲的循环播放功能true
		playPauseBtn.on('click',playPause); // 点击播放/暂停 按钮，触发playPause函数
		// 进度条 移入/移出/点击 动作触发相应函数
		sArea.mousemove(function(event){ showHover(event)});
		sArea.mouseout(hideHover);
		sArea.on('click',playFromClickedPos);

		// 实时更新播放时间
		$(audio).on('timeupdate',updateCurrTime);

		// 上下首切换
		playPrevBtn.on('click',function(){ selectTrack(-1);updateIte()});
		playNextBtn.on('click',function(){selectTrack(1);updateIte()});
		$(".down").click(() => {
			fba.parseLazyRuleAsync($$$(playurl).lazyRule((info) => {
				try{lx=input.split('\?')[0]} catch(e){};
				lx = /\.[^\.]+$/.exec(lx);
				confirm({
					title: '下载到Music目录',
					content: info+lx,
					confirm: $.toString((input,info,lx) => {
						downloadFile(input, 'file:///storage/emulated/0/Music/歌词适配/'+info +lx);
						return 'toast://'+info+'下载中';
					},input,info,lx),
				});
			}, info), $$$.toString(() => {}));
		})
		$("#eq").click(() => {
			let MaxH = window.screen.height
			let ShowH = document.documentElement.clientHeight;
			if (MaxH> ShowH) {
				fba.refreshX5Desc('float&&'+MaxH);
				$('#lrc').fadeIn("500");
			} else {
				fba.refreshX5Desc('float&&300');
				$('#lrc').fadeOut("500");
			}
		})
	}
	
	
	//动态刷新
	function updateIte() {
		fba.parseLazyRule($$$(musicID[currIndex]).lazyRule((info) => {
			if(getVar('样式')=='text_1')
				xy='““””<b><font color='+ getVar('选中颜色')+'>' + input + '</font></b>';
			else
				xy='<b><font color='+ getVar('选中颜色')+'>' + input + '</font></b>';
			xy='““””<b><font color='+ getVar('选中颜色','#1AB16B')+'>' + input + '</font></b>';
			deleteItemByCls('菜单');
			if (getVar('刷新id') != input) {
				updateItem(input, {
					title: ' ‘‘’’<b><font color=#1AB16B>' + info + '</font></b>',
				});
				updateItem(getVar('刷新id'), {
					title: getVar('刷新info', '00'),
				});
				putVar('刷新id', input);
				putVar('刷新info', info);
			}
		},info));
	}

	$('#player-content1, .music-imgs').css({'transition':' 0.0s ease all'});
	initPlayer();

});

function Alert(title, text) {
	if (typeof(text) != 'string') text=JSON.stringify(text)
	$$$(text).x5LazyRule((title) => {
		confirm({title: title,
			content: input,
		})
	},title)
}
let ln = 'hiker://files/rules/dzHouse/html/';
var push_tips;
function update(Up) {
	if (request(ln+'h5bfq.json')!=Up) {
		if (push_tips) Alert("H5音乐播放器更新提示", push_tips);
		var x5 = request('https://hikerfans.com/weisyr/h5音乐播放器.html');
		if(x5.indexOf("player-content")>0) {
			fba.writeFile(ln+'h5音乐播放器.html',x5)
			fba.writeFile(ln+'h5bfq.json',Up);
			Alert("H5音乐播放器更新完成", "祝君顺利")
		} else {
			Alert("H5音乐播放器更新出错", "一切随缘")
			fba.writeFile(ln+'h5bfq.json',Up);
		}
	}
}
if (!fba.getVar('X5播放器加载')) {
	requestAsync("https://hikerfans.com/weisyr/plug/h5bfq.js",(key,html)=>{eval(html);})
}
fba.putVar('X5播放器加载', '完成')
</script>
</body>
</html>